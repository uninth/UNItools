Content-type: text/html

<HTML><HEAD><TITLE>Manpage of bmon</TITLE>
</HEAD><BODY>
<H1>bmon</H1>
Section: Maintenance Commands (8)<BR>Updated: Oct 27, 2004<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

bmon - Portable bandwidth monitor and rate estimator
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B>bmon</B>

[
<B>-awShV</B>

] [
<B>-i</B>

<I>&lt;mod&gt;</I>

] [
<B>-o</B>

<I>&lt;mod&gt;</I>

] [
<B>-I</B>

<I>&lt;mod&gt;</I>

] [
<B>-O</B>

<I>&lt;mod&gt;</I>

]
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[
<B>-f</B>

<I>&lt;path&gt;</I>

] [
<B>-p</B>

<I>&lt;policy&gt;</I>

] [
<B>-r</B>

<I>&lt;float&gt;</I>

] [
<B>-s</B>

<I>&lt;float&gt;</I>

]
<P>

<P>
<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

bmon is a portable bandwidth monitor with multiple input
methods and output modes. A set of architecture specific
input modules provide the core with the listof interfaces
and their counters. The core stores this counters and
provides rate estimation including a history over the last
60 seconds, minutes, hours and days to the output modules
which output them according to the configuration.
<P>
The set of counters is dependant on the input module and
may vary. Secondary input and output modules may be used
to collect counter values from other nodes or to write
HTML statistics. This input/output architecture minimizes
the work needed to port it to other architectures or
generate specific statistics.
<P>
<A NAME="lbAE">&nbsp;</A>
<H2>OPTIONS</H2>

<DL COMPACT>
<DT><B>-i</B>

<DD>
Set primary <I>input module</I>  and its configuration. The
argument &quot;list&quot; will result in a list of available input
modules. See INPUT MODULES for more details.
<DT><B>-o</B>

<DD>
Set primary <I>output module</I> and its configuration. The
argument &quot;list&quot; will result in a list of available output
modules. See OUTPUT MODULES for more details.
<DT><B>-I</B>

<DD>
Set secondary <I>input modules</I> and their configuration.
The argument &quot;list&quot; will result in a list of available
secondary input modules.
<DT><B>-O</B>

<DD>
Set secondary <I>output modules</I> and their configuration.
The argument &quot;list&quot; will result in a list of available
secondary output modules.
<DT><B>-f</B>

<DD>
Set alternative configuration <I>path</I>.
<DT><B>-p</B>

<DD>
Set interface acceptance policy. See INTERFACE SELECTION for
more details.
<DT><B>-a</B>

<DD>
Include interfaces even if their status is down.
<DT><B>-r</B>

<DD>
Set reading <I>interval</I> in which the input module will be
called. The default for this is one second. Should be less or
equal than 1 or a factor of it. Values not equal to 1 will
result in additional rate calculation with the read interval
as its unit.
<DT><B>-s</B>

<DD>
Set sleeping <I>interval</I> between calls to output short
interval callbacks for interactive output modules. Changing
this can affect the variance of read intervals.
<DT><B>-w</B>

<DD>
Enable signal driven output intervals. The output module will
only be invoked upon receiving of SIGUSR1. Use bmon -S - to
send the signal to a running bmon instance in signal driven mode.
<DT><B>-S</B>

<DD>
Send SIGUSR1 to a running bmon instance. This arugment takes
either <I>-</I> which will result in invoking ps to find bmon
instances or a <I>pid</I> directly.
<DT><B>-h</B>

<DD>
Prints a help text and exits.
<DT><B>-V</B>

<DD>
Prints the version and exits.
<P>
</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>INPUT MODULES</H2>

<P>
Input modules provide the core with interface statistics.
Two kinds of modules exist, primary and secondary input
modules. Their main difference is usage, there may be only
one primary module running at the same time while the number
of secondary input modules is not limited.
<P>
Every input module has a description, help text and list of
options available which can be seen by adding the option
&quot;help&quot; to the module options:
<DL COMPACT>
<DT><DL COMPACT><DT><DD>
<DD>

bmon -i netlink:help

</DL>

<P>
See MODULE CONFIGURATION for mode details.
<P>
<P>
</DL>
<A NAME="lbAG">&nbsp;</A>
<H2>PRIMARY INPUT MODULES</H2>

<DL COMPACT>
<DT><B>netlink</B> (Linux)<DD>
Requires libnl and uses an rtnetlink to collect interface
statistics. This input module also provides statistics about
traffic control qdiscs and classes. It is the preferred
input module on Linux.
<P>
<DT><B>kstat</B> (SunOS)<DD>
Provides interface statistics on SunOS operating systems in
form of 32bit and 64bit counters. It is the preferred input
module on SunOS.
<P>
<DT><B>sysctl</B> (BSD, Darwin)<DD>
Provides interface statistics on BSD and Darwin operating
systems. Is is the preferred input module on any BSD
alike system.
<P>
<DT><B>proc</B> (Linux)<DD>
Provides interface statistics on Linux using the proc
filesystem (/proc/net/dev). It is one of the fallback
input modules on Linux and will work on nearly every
Linux kernel version.
<P>
<DT><B>sysfs</B> (Linux)<DD>
Provides interface statistics on Linux using the sys
filesystem (/sys/class/net/). It may be used together
with newer Linux kernel versions but has no real
advantage over the netlink input module. It caches
open file descriptors to speed it up and is used
as fallback method.
<P>
<DT><B>netstat</B> (POSIX)<DD>
Provides limited interface statistics on almost any
POSIX operating system by invoking netstat -i -a. Only
use this as last hope.
<P>
<DT><B>dummy</B> (any)<DD>
The purpose of the dummy input module is for testing. It
generates in either a static or randomized form.
<P>
<DT><B>nulll</B> (any)<DD>
Does not provide any interface statistics and thus can be
used to disable local interface collection.
<P>
</DL>
<A NAME="lbAH">&nbsp;</A>
<H2>SECONDARY INPUT MODULES</H2>

<P>
<DL COMPACT>
<DT><B>distribution</B><DD>
Collects interface statistics from other nodes. It is the
counterpart of the secondary output module called distribution.
Its purpose is to distribute statistics in real time with
not too much bandwidth consumption itself. See DISTRIBUTION
for more details.
<P>
</DL>
<A NAME="lbAI">&nbsp;</A>
<H2>OUTPUT MODULES</H2>

<P>
Output modules are feeded with rate estimations and graphs
from the core and print them out to the configured output
device. Two kinds of modules exist, primary and secondary
output modules. Their main difference is usage, there may be
only one primary module running at the same time while the number
of secondary output modules is not limited.
<P>
Every output module has a description, help text and list of
options available which can be seen by adding the option
&quot;help&quot; to the module options:
<DL COMPACT>
<DT><DL COMPACT><DT><DD>
<DD>

bmon -o ascii:help

</DL>

<P>
See MODULE CONFIGURATION for mode details.
<P>
</DL>
<A NAME="lbAJ">&nbsp;</A>
<H2>PRIMARY OUTPUT MODULES</H2>

<P>
<DL COMPACT>
<DT><B>ascii</B><DD>
The ascii output modules prints out the diagrams and
lists to standard output. The output format is highly
configurable and suits as vmstat alike tool for interface
statistics.
<P>
<DT><B>curses</B><DD>
Interactive curses user interface providing real time rate
estimations and graphs. The default view is a list of all
interfaces grouped per node. The graphical history diagram
and a list of detailed counters may be enabled/disable
during runtime. Press '?' while the UI is running to see
the quick reference.
<P>
</DL>
<A NAME="lbAK">&nbsp;</A>
<H2>SECONDARY OUTPUT MODULES</H2>

<P>
<DL COMPACT>
<DT><B>html</B><DD>
Writes all interface statistics and diagrams as HTML files including
a navigation menu for all nodes and their interfaces. The layout
can be easly changes by altering the stylesheet which will not be
overwritten.
<P>
<DT><B>distribution</B> (any)<DD>
Distributes all statistics over the network using an UDP based
statistic distribution protocol. The default configuration will
use the multicast address all-nodes but it may also be configured
so send to a unicast address.
<P>
<P>
</DL>
<A NAME="lbAL">&nbsp;</A>
<H2>MODULE CONFIGURATION</H2>

<P>
ARGUMENT ::= modulename:OPTS[,modulename:OPTS[,...]]
<BR>

OPTS     ::= OPTION[;OPTION[;...]]
<BR>

OPTION   ::= type[=value]
<P>
If you specify multiple primrary input or output modules the
first reported to be working module will be used.
<P>
If you specify multiple secondary input or output modules all
of them will get invoked.
<P>
<A NAME="lbAM">&nbsp;</A>
<H2>DISTRIBUTION</H2>

<P>
Statistic distribution is a powerful method to spread the statistic
all over the network and make the available on every machine. The
advantage over web based statistic overviews and multi terminal
remote shell based solutions is its nearly realtime accuracy while
being lightweight and not polluting the network too much. The protocol
is UDP based and thus not reliable and optmized on size.
<P>
See include/bmon/distribution.h for the protocol specification.
<P>
<A NAME="lbAN">&nbsp;</A>
<H2>DIAGRAM TYPES</H2>

<P>
You will find the following diagram types being used by all output
modules in some form:
<P>
<DL COMPACT>
<DT><B>list</B><DD>
A list of interfaces including their byte and packets rate (bps/pps).
<P>
<DT><B>graphical history diagram </B><DD>
A graph showing the history of a counter over the last 60 (read interval/
seconds/minutes/hours/days). The outer left column is the most recent
rate while the outer right column is the most outdated. The preferred
diagram to impress co-workers.
<P>
<DT><B>detailed</B><DD>
Detailed counters such as error counters or other attributes assigned
to this interface. The list of attributes may very depending on the
input module and architecture of the host OS.
<P>
</DL>
<A NAME="lbAO">&nbsp;</A>
<H2>INTERFACE SELECTION</H2>

<P>
SELECTION ::= NAME[,NAME[,...]]
<BR>

NAME      ::= [!]interface
<P>
The interface name may contain the character '*' which will act as a wildcard and represents any
number of any character type, i.e. eth*, h*0, ...
<P>
<DL COMPACT>
<DT>Examples:<DD>
<DL COMPACT><DT><DD>

lo,eth0,eth1

</DL>

<DL COMPACT><DT><DD>

eth*,!eth0

</DL>

<P>
</DL>
<A NAME="lbAP">&nbsp;</A>
<H2>CONFIGURATION FILE</H2>

<P>
Bmon will try and read configuration data from the following
files in the specified order: /etc/bmon.conf, $HOME/.bmonrc.
<P>
None of the above files will be read if the path to the
configuration file was specified using the -f option.
<P>
Configuration possibilities:
<P>
<B>input</B> <I>&lt;module configuration&gt;</I>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Specify primary input module (-i), see INPUT MODULES.
<P>
<B>secondary_input</B> <I>&lt;module configuration&gt;</I>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Specify secondary input modules (-I), see INPUT MODULES.
<P>
<B>output</B> <I>&lt;module configuration&gt;</I>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Specify primary output module (-o), see OUTPUT MODULES.
<P>
<B>secondary_output </B><I>&lt;module configuration&gt;</I>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Specify secondary output modules (-O), see OUTPUT MODULES.
<P>
<B>policy </B><I>&lt;policy&gt;</I>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Set interface acceptance policy (-p), see INTERFACE SELECTION.
<P>
<B>read_interval </B><I>&lt;interval&gt;</I>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Set reading interval in which the input module will be called
(-r).
<P>
<B>sleep_time </B><I>&lt;interval&gt;</I>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Set sleeping interval between calls to output short interval
callbacks for interactive output modules. (-s)
<P>
<B>show_all</B>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Include interface even if their status is down. (-a)
<P>
<B>include</B> <I>&lt;file&gt;</I>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Include <I>file</I> and read it as configuration file.
<P>
<B>Color layouts</B>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
See COLOR LAYOUTS.
<P>
<B>Bindings</B>
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
See BIND INTERFACE.
<P>
<P>
<A NAME="lbAQ">&nbsp;</A>
<H2>COLOR LAYOUTS</H2>

<P>
The layout is used to specify the look'n'feel of the curses
output module. The color &quot;default&quot; represents the terminal
color which can be used to keep the background transparent
for transparent terminals.
<P>
<P>

<B>Colors:</B>

default, black, red, green, yellow, blue, magenta, cyan, white
<P>

<B>Flags:</B>

reverse
<P>

<B>Layouts:</B>

Default, Statusbar, Header, List, Selected, 
<P>
Prototype:
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<B>Layout</B> <I>&lt;name&gt;</I> <I>&lt;foreground&gt;</I> <I>&lt;background&gt;</I> <I>&lt;flags&gt;</I>
<P>
Example:
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Layout Statusbar red black reverse
<P>
Feel free to submit patches extending the configurability using layouts.
<P>
<A NAME="lbAR">&nbsp;</A>
<H2>BIND INTERFACE</H2>

<P>
The bind interface can be used to bind not yet assigned keys to
shell scripts. It currently works in the curses output module but
it might be ported to other output modules in the future. The interface
name of the currently selected interface is provided to the script
via the first argument.
<P>
Prototype:
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<B>Bind</B> <I>&lt;key&gt;</I> <I>&lt;Executable&gt;</I>
<P>
Example:
<BR>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
bind D /sbin/intf_down.sh
<P>
<A NAME="lbAS">&nbsp;</A>
<H2>EXAMPLES</H2>

<P>
To run bmon in curses mode monitoring the interfaces eth0
and eth1:
<DL COMPACT><DT><DD>

<B>bmon -i eth0,eth1 -o curses</B>

</DL>

<P>
To run bmon in acii mode printing the detailed diagram
with fixed y-axis unit:
<DL COMPACT><DT><DD>

<B>bmon -o 'ascii:diagram=detailed;ynit=kb'</B>

</DL>

<P>
To run bmon in signal driven mode drawing the graphical
diagram with customized drawing characters and fixed x
and y axis:
<DL COMPACT><DT><DD>

<B>bmon -s -o 'ascii:diagram=graph;fgchar=#;bgcar=_;xunit=min'</B>

</DL>

<P>
To run bmon with no primrary output (daemon) but
distribute the statistic over the network:
<DL COMPACT><DT><DD>

<B>bmon -o null -O distribution</B>

</DL>

<P>
To run bmon collecting local and remote statistics and
show it in curses mode:
<DL COMPACT><DT><DD>

<B>bmon -I distribution:multicast -o curses</B>

</DL>

<P>
To build a relay and collect remote statistic and send
them to a unicast address while ignoring errors because
the destination is not available:
<DL COMPACT><DT><DD>

<B>bmon -i null -I distribution:multicast -o null -O 'distribution:ip=10.0.0.1;errignore;forward'</B>

</DL>

<P>
To collect local statistics and those from the whole
network and generate a HTML page out of the those
statistics:
<DL COMPACT><DT><DD>

<B>bmon -I distribution:multicast -o null -O html:path=/var/istats/</B>

</DL>

<P>
<A NAME="lbAT">&nbsp;</A>
<H2>KNOWN ISSUES</H2>

The curses output modules doesn't work properly on NetBSD &lt; 2.0 because getch() cannot be set to be non-blocking.
<P>
sysctl input segfaults on sparc64 OpenBSD.
<P>
<A NAME="lbAU">&nbsp;</A>
<H2>FILES</H2>

/etc/bmon.conf
<BR>

$HOME/.bmonrc
<P>
<P>
<A NAME="lbAV">&nbsp;</A>
<H2>SEE ALSO</H2>

<A HREF="../man8/ifconfig.8.html">ifconfig</A>(8), <A HREF="../man1M/kstat.1M.html">kstat</A>(1M), <A HREF="../man3/netlink.3.html">netlink</A>(3)
<P>
<A NAME="lbAW">&nbsp;</A>
<H2>AUTHOR</H2>

Thomas Graf &lt;<A HREF="mailto:tgraf@suug.ch">tgraf@suug.ch</A>&gt;
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">OPTIONS</A><DD>
<DT><A HREF="#lbAF">INPUT MODULES</A><DD>
<DT><A HREF="#lbAG">PRIMARY INPUT MODULES</A><DD>
<DT><A HREF="#lbAH">SECONDARY INPUT MODULES</A><DD>
<DT><A HREF="#lbAI">OUTPUT MODULES</A><DD>
<DT><A HREF="#lbAJ">PRIMARY OUTPUT MODULES</A><DD>
<DT><A HREF="#lbAK">SECONDARY OUTPUT MODULES</A><DD>
<DT><A HREF="#lbAL">MODULE CONFIGURATION</A><DD>
<DT><A HREF="#lbAM">DISTRIBUTION</A><DD>
<DT><A HREF="#lbAN">DIAGRAM TYPES</A><DD>
<DT><A HREF="#lbAO">INTERFACE SELECTION</A><DD>
<DT><A HREF="#lbAP">CONFIGURATION FILE</A><DD>
<DT><A HREF="#lbAQ">COLOR LAYOUTS</A><DD>
<DT><A HREF="#lbAR">BIND INTERFACE</A><DD>
<DT><A HREF="#lbAS">EXAMPLES</A><DD>
<DT><A HREF="#lbAT">KNOWN ISSUES</A><DD>
<DT><A HREF="#lbAU">FILES</A><DD>
<DT><A HREF="#lbAV">SEE ALSO</A><DD>
<DT><A HREF="#lbAW">AUTHOR</A><DD>
</DL>
<HR>
This document was created by
<A HREF="http://localhost/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 18:57:51 GMT, August 22, 2012
</BODY>
</HTML>
