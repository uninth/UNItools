head	1.9;
access;
symbols;
locks; strict;
comment	@# @;


1.9
date	2012.12.10.14.05.01;	author root;	state Exp;
branches;
next	1.8;

1.8
date	2008.03.25.16.00.48;	author admin;	state Exp;
branches;
next	1.7;

1.7
date	2008.02.04.12.52.32;	author root;	state Exp;
branches;
next	1.6;

1.6
date	2007.12.11.11.43.12;	author root;	state Exp;
branches;
next	1.5;

1.5
date	2007.11.26.09.08.36;	author root;	state Exp;
branches;
next	1.4;

1.4
date	2007.11.16.09.52.19;	author root;	state Exp;
branches;
next	1.3;

1.3
date	2007.07.16.09.22.16;	author root;	state Exp;
branches;
next	1.2;

1.2
date	2007.07.04.11.00.07;	author root;	state Exp;
branches;
next	1.1;

1.1
date	2007.06.27.09.53.29;	author root;	state Exp;
branches;
next	;


desc
@@


1.9
log
@*** empty log message ***
@
text
@#!/bin/sh
#
# $Header: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v 1.8 2008/03/25 16:00:48 admin Exp $
#
# Lille Linux centrisk dims til dokumentation af statisk route pr. interface
#

printifcfg() {

	# printifcfg "${E}" "${NET}" "${PREFIX}" "${LINK}" "${SPEED}" "${DUPLEX}"
	# printifcfg "${E}" "${NET}" "${PREFIX}"
	case $TYPE in
		HTML)	interface "${1}"  "${NET}/${PREFIX}"
		;;
		TXT)	printf "%10s: %10s/%2d %s %s %s\n" "${1}" "${2}" "${3}" "${4}" "${5}" "${6}"
		;;
	esac

}

printrute() {
	case $TYPE in
		HTML)	
			case $BG in
				0)	BG=1
					forward		"${1}/${2}" "$3"
				;;

				1)	BG=0
					reverse		"${1}/${2}" "$3"
				;;
			esac
		;;
		TXT)	printf "\t%15s/%-2d\t->%20s\n" "${1}" "${2}" "$3"
		;;
	esac
}

printspace() {
	case $TYPE in
		HTML)	:
		;;
		TXT)	echo
		;;
	esac
}

html_head() {
TITLE="route information"

cat << EOF
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
		<HEAD>
        <META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=UTF-8">
		<TITLE>$TITLE</TITLE>
<STYLE TYPE="text/css">
BODY,DIV,TABLE,THEAD,TBODY,TFOOT,TR,TH,TD,P { font-family:"Arial"; font-size:x-small }
p.white {color: #FFFFFF}
body { color: #000000; } span.c1 {color: #FFFFFF}
span.c4 {color: red}
td.c3 {background-color: #E6E6E6}
td.c2 {background-color: #999999}
td.c1 {background-color: #0066CC}
.copyright { border-top: 1px solid #999; font-family:verdana, arial, sans-serif; font-size:10px; color:#999; line-height:14px; }
</STYLE>
    </HEAD>
    <H1>IP og rute konfiguration pÃ¥ firewall</H1>
    <H2>$FQDN</H2>
    <H3>$NOW</I></H3>

EOF
}

html_body() {
cat << EOF
    <BODY LANG="da-DK" DIR="ltr">
    <!--
	valid as of `/bin/date`
	$FQDN
	`uname -a`
    -->
EOF
}

table_head()
{
cat << EOF
        <TABLE WIDTH="100%" BORDER="1" CELLPADDING="4" CELLSPACING="0">
            <COL WIDTH="25%">
            <COL WIDTH="25%">
            <COL WIDTH="25%">
            <COL WIDTH="25%">
            <TR VALIGN="top">
                <TD WIDTH="152" BGCOLOR="#0066CC"><P CLASS="white">Interface</P></TD><TD WIDTH="153" BGCOLOR="#0066CC"><P CLASS="white">IP</P></TD>
                <TD WIDTH="153" BGCOLOR="#0066CC"><P CLASS="white">Rute</P></TD>
                <TD WIDTH="152" BGCOLOR="#0066CC"><P CLASS="white">gateway</P></TD>
            </TR>
EOF
}

interface() 
{
IFNAME=$1
IP=$2
cat << EOF
            <TR VALIGN="top">
		<TD WIDTH="152" BGCOLOR="#999999"><P>${IFNAME}</P></TD>
                <TD WIDTH="153" BGCOLOR="#999999"><P>${IP}</P></TD>
                <TD WIDTH="153" BGCOLOR="#999999"><P><BR></P></TD>
                <TD WIDTH="152" BGCOLOR="#999999"><P><BR></P></TD> 
            </TR>
EOF
}

forward()
{
IP=$1
GW=$2
cat << EOF
            <TR VALIGN="top"><TD WIDTH="152" BGCOLOR="#E6E6E6"><P><BR></P></TD>
                <TD WIDTH="153" BGCOLOR="#E6E6E6"><P><BR></P></TD>
                <TD WIDTH="153"><P>${IP}</P></TD>
                <TD WIDTH="152"><P>${GW}</P></TD>
            </TR>
EOF
}

reverse()
{
IP=$1
GW=$2
cat << EOF
            <TR VALIGN="top"><TD WIDTH="152" BGCOLOR="#E6E6E6"><P><BR></P></TD><TD WIDTH="153" BGCOLOR="#E6E6E6"><P><BR></P></TD>
                <TD WIDTH="153" BGCOLOR="#E6E6E6"><P>${IP}</P></TD>
                <TD WIDTH="152" BGCOLOR="#E6E6E6"><P>${GW}</P></TD>
            </TR>
EOF
}

table_end() {
	cat << EOF
        </TABLE>
        <BR>
EOF
}

html_end() {
cat << EOF
<P>Der tages forbehold for fejl. IP og rutetabellen er begrÃ¦nset til IPv4 og indeholder ikke tunnel og loopback information</P><DIV CLASS="copyright"><BR><SPAN>Oversigt Copyright Â© 2007 UNI<SPAN CLASS="c4">Â·</SPAN>Cs sikkerhedsafdeling.</SPAN></DIV>
    </BODY>
</HTML>
EOF
}

################################################################################
#
# Main
#
################################################################################

NOW=`/bin/date +'%d %b %Y kl. %T'`
# NOW=`date +"%A den %d %B %Y kl. %H:%M"`

DNSDOMAIN=`domainname`
case $DNSDOMAIN in
	""|\(none\))
		DNSDOMAIN=""    # fqdn kan vÃ¦re identisk med `hostname`
	;;
	*)      DNSDOMAIN=".${DNSDOMAIN}"
esac

# Der er ingen garanti for, at navnet findes i en ekstern DNS.
FQDN="`hostname`${DNSDOMAIN}"

ETH=`ifconfig -a| sed '
	/^[ 	]/d;
	s/[ 	].*//
	 /^$/d
	/^lo/d
	'`

TYPE=TXT
BG=0

case $1 in
	html)	TYPE=HTML
		html_head
		html_body
		table_head
	;;
	"")	cat << EOF
                 IP and ROUTE
date...........: `/bin/date`
fqdn...........: $FQDN
uname..........: `uname -a`

EOF
	;;
esac

for E in $ETH
do

	ifconfig $E | sed "/inet/!d; /inet6/d; s/.*addr://; s/[ 	].*ask:/	/ " | while read NET MASK
	do

		# eth2.xxx -> eth2
		REAL_E=`echo $E |sed 's/\..*//'`
 
		LINK=`ethtool $REAL_E	| sed '/Link/!d'`
		SPEED=`ethtool $REAL_E	| sed '/Speed/!d'`
		DUPLEX=`ethtool $REAL_E	| sed '/Duplex/!d'`

		PREFIX=`ipcalc -p  $NET $MASK | sed 's/.*=//'`
		printifcfg "${E}" "${NET}" "${PREFIX}" "${LINK}" "${SPEED}" "${DUPLEX}"

		netstat -rn | grep $E | awk  '
			#$0 ~ /0.0.0.0/	{ next }
					{ print $1 " " $3 " " $2 }
					' | while read N M GW
					do
						P=`ipcalc -p $N $M | sed 's/.*=//'`
						if [ "$GW" = "0.0.0.0" ]; then
							: ignore kernel route
						else
							printrute "${N}" "${P}" "$GW"
						fi

					done
		printspace
	done
done

case $TYPE in
	HTML)	table_end
		html_end
	;;
	*)	echo
	;;
esac

exit 0

#
# Documentation and  standard disclaimar
#
# Copyright (C) 2001 Niels Thomas HaugÃ¥rd
# UNI-C
# http://www.uni-c.dk/
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the 
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License 
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
#
#++
# NAME
#	printiproute.sh 1
# SUMMARY
#	print statisk rute pr. interface
# PACKAGE
#	UNItools
# SYNOPSIS
#	printiproute
# BESKRIVELSE
#	\fCprintiproute(1)\fR anvendes til dokumentation af rute udtryk
#	pr. interface.
#
#	Programmet er ad-hoc.
# OPTIONS
# .TP
#	html. Udskriv i html til stdout.
# SE OGSÃ…
#	Dokumentationen for UNItools.
# DIAGNOSTICS
#	Programmet er Linux - centrisk og krÃ¦ver pakken UNItools er installeret.
# BUGS
#	Det er der sikkert. Ret dem og send mig en opdatering.
# VERSION
#	$Date: 2008/03/25 16:00:48 $
# .br
#	$Revision: 1.8 $
# .br
#	$Source: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v $
# .br
#	$State: Exp $
# HISTORY
#	Se \fCrlog\fR $Id: printiproute,v 1.8 2008/03/25 16:00:48 admin Exp $
# AUTHOR(S)
#	Niels Thomas HaugÃ¥rd
# .br
#	E-mail: thomas@@haugaard.net
# .br
#	UNI\(buC
# .br
#	DTU, Building 304
# .br
#	DK-2800 Kgs. Lyngby
#--
@


1.8
log
@fjernet inet6
@
text
@d3 1
a3 1
# $Header: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v 1.7 2008/02/04 12:52:32 root Exp admin $
d49 2
d54 3
d68 1
a68 1
    <H1>IP og rute konfiguration på firewall</H1>
d150 1
a150 1
<P>Der tages forbehold for fejl. IP og rutetabellen er begrænset til IPv4 og indeholder ikke tunnel og loopback information</P><DIV CLASS="copyright"><BR><SPAN>Oversigt Copyright © 2007 UNI<SPAN CLASS="c4">·</SPAN>Cs sikkerhedsafdeling.</SPAN></DIV>
d168 1
a168 1
		DNSDOMAIN=""    # fqdn kan være identisk med `hostname`
d248 1
a248 1
# Copyright (C) 2001 Niels Thomas Haugård
d283 1
a283 1
# SE OGSÅ
d286 1
a286 1
#	Programmet er Linux - centrisk og kræver pakken UNItools er installeret.
d290 1
a290 1
#	$Date: 2008/02/04 12:52:32 $
d292 1
a292 1
#	$Revision: 1.7 $
d298 1
a298 1
#	Se \fCrlog\fR $Id: printiproute,v 1.7 2008/02/04 12:52:32 root Exp admin $
d300 1
a300 1
#	Niels Thomas Haugård
@


1.7
log
@*** empty log message ***
@
text
@d3 1
a3 1
# $Header: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v 1.3 2007/07/16 09:22:16 root Exp $
d200 1
a200 1
	ifconfig $E | sed "/inet/!d; s/.*addr://; s/[ 	].*ask:/	/ " | while read NET MASK
d285 1
a285 1
#	$Date: 2007/07/16 09:22:16 $
d287 1
a287 1
#	$Revision: 1.3 $
d293 1
a293 1
#	Se \fCrlog\fR $Id: printiproute,v 1.3 2007/07/16 09:22:16 root Exp $
@


1.6
log
@*** empty log message ***
@
text
@d3 1
a3 1
# $Header: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v 1.5 2007/11/26 09:08:36 root Exp $
d53 8
a60 1
 p.white {color: #FFFFFF}
d63 4
d75 1
a75 1
	hostname `hostname`.`domainname`
d145 1
d157 14
d190 1
a190 1
fqdn...........: `hostname`.`domainname`
d205 1
a205 1

d285 1
a285 1
#	$Date: 2007/11/26 09:08:36 $
d287 1
a287 1
#	$Revision: 1.5 $
d293 1
a293 1
#	Se \fCrlog\fR $Id: printiproute,v 1.5 2007/11/26 09:08:36 root Exp $
@


1.5
log
@rettet fejl i html print (manglede /)
@
text
@d3 1
a3 1
# $Header: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v 1.3 2007/07/16 09:22:16 root Exp $
d177 6
a182 3
		LINK=`ethtool $E | sed '/Link/!d'`
		SPEED=`ethtool $E | sed '/Speed/!d'`
		DUPLEX=`ethtool $E | sed '/Duplex/!d'`
d259 1
a259 1
#	$Date: 2007/07/16 09:22:16 $
d261 1
a261 1
#	$Revision: 1.3 $
d267 1
a267 1
#	Se \fCrlog\fR $Id: printiproute,v 1.3 2007/07/16 09:22:16 root Exp $
@


1.4
log
@*** empty log message ***
@
text
@d3 1
a3 1
# $Header: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v 1.1 2007/06/27 09:53:29 root Exp $
d10 1
d15 1
a15 1
		TXT)	printf "%10s: %10s/%2d\n" "${1}" "${2}" "${3}"
d177 3
d182 1
a182 1
		printifcfg "${E}" "${NET}" "${PREFIX}"
d256 1
a256 1
#	$Date: 2007/06/27 09:53:29 $
d258 1
a258 1
#	$Revision: 1.1 $
d264 1
a264 1
#	Se \fCrlog\fR $Id: printiproute,v 1.1 2007/06/27 09:53:29 root Exp $
@


1.3
log
@*** empty log message ***
@
text
@d3 1
a3 1
# $Header: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v 1.2 2007/07/04 11:00:07 root Exp $
a9 1
	# printifcfg "${E}" "${NET}" "${PREFIX}" "${LINK}" "${SPEED}" "${DUPLEX}"
d12 1
a12 1
		HTML)	interface "${1}"  "${NET}${PREFIX}"
d14 1
a14 1
		TXT)	printf "%10s: %10s/%2d %s %s %s\n" "${1}" "${2}" "${3}" "${4}" "${5}" "${6}"
a175 3
		LINK=`ethtool $E | sed '/Link/!d'`
		SPEED=`ethtool $E | sed '/Speed/!d'`
		DUPLEX=`ethtool $E | sed '/Duplex/!d'`
d178 1
a178 1
		printifcfg "${E}" "${NET}" "${PREFIX}" "${LINK}" "${SPEED}" "${DUPLEX}"
d252 1
a252 1
#	$Date: 2007/07/04 11:00:07 $
d254 1
a254 1
#	$Revision: 1.2 $
d260 1
a260 1
#	Se \fCrlog\fR $Id: printiproute,v 1.2 2007/07/04 11:00:07 root Exp $
@


1.2
log
@*** empty log message ***
@
text
@d3 1
a3 1
# $Header: /lan/ssi/projects/UNItools/src/SPLAT/NGX/pkgs/scripts/scripts-1.0/RCS/printiproute,v 1.1 2007/06/27 09:53:29 root Exp $
d10 1
d15 1
a15 1
		TXT)	printf "%10s: %10s/%2d\n" "${1}" "${2}" "${3}"
d177 3
d182 1
a182 1
		printifcfg "${E}" "${NET}" "${PREFIX}"
d256 1
a256 1
#	$Date: 2007/06/27 09:53:29 $
d258 1
a258 1
#	$Revision: 1.1 $
d264 1
a264 1
#	Se \fCrlog\fR $Id: printiproute,v 1.1 2007/06/27 09:53:29 root Exp $
@


1.1
log
@Initial revision
@
text
@d3 1
a3 1
# $Header$
d8 136
d151 18
a168 4
echo "IP and ROUTE on `hostname`.`domainname`"
uname -a
/bin/date
echo
d178 1
a178 2
		#echo "$E ${NET}/${PREFIX} ($MASK)"
		printf "%10s: %10s/%2d\n" "${E}" "${NET}" "${PREFIX}"
d189 1
a189 1
							printf "\t%15s/%-2d\t->%20s\n" "${N}" "${P}" "$GW"
d193 1
a193 1
		echo ""
d197 7
d244 1
a244 1
#	Ingen.
d252 1
a252 1
#	$Date: 2003/08/13 13:40:31 $
d254 1
a254 1
#	$Revision: 1.17 $
d256 1
a256 1
#	$Source: /lan/ssi/projects/UNIfwbu/src/RCS/UNIfwbu.sh,v $
d260 1
a260 1
#	Se \fCrlog\fR $Id: UNIfwbu.sh,v 1.17 2003/08/13 13:40:31 admin Exp $
@
